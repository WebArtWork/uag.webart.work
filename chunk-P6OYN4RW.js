import{a as Je}from"./chunk-QDH4MIVX.js";import{a as Ce}from"./chunk-3SNXAVZY.js";import{r as Qe,t as Ke,y as Ge}from"./chunk-KRWE5CTW.js";import{Ab as ne,C as Q,Da as Ee,Ea as Le,Fa as Z,Ga as T,H as p,Hb as Xe,I as h,Ia as _,Jb as Ye,Ka as c,Na as Be,O as K,Oa as fe,Pa as xe,R as He,Ta as A,Ua as N,Va as X,W as G,Wb as $e,X as le,Xa as v,Y as g,Ya as W,aa as Ae,ca as q,cb as je,d as Pe,db as ee,eb as F,ha as V,kb as qe,lb as Ne,ma as J,n as E,o as _e,ob as Y,pb as $,qa as k,ra as H,rb as te,s as Ve,ta as We,tb as ie,ua as De,v as ue,va as Ue,vb as D,wa as w,wb as y,xa as l,y as ke,ya as m,za as I}from"./chunk-YWXTHJOJ.js";import{a as C,b as U,h as M}from"./chunk-CIWMVH6F.js";function Ze(r){return new Promise((t,e)=>{let i=new FileReader;i.onload=()=>t(i.result),i.onerror=e,i.readAsDataURL(r)})}var z={label:"",placeholder:"Select file",disabled:!1,clearable:!0,accept:"*/*",preview:!0,mode:"single-image",view:"dropzone",cropWidth:null,cropHeight:null,container:"general",name:""};var Me=(()=>{class r extends Ke{constructor(){super({name:"file"}),this._http=Q(Qe)}uploadBase64(e,i="general",n=""){return M(this,null,function*(){return yield new Promise(o=>{this._http.post("/api/file/photo",{container:i,name:n,dataUrl:e},a=>o(a))})})}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275prov=ke({token:r,factory:r.\u0275fac,providedIn:"root"})}}return r})();var lt=["wrapper"],pt=["sourceImage"];function ht(r,t){if(r&1){let e=T();l(0,"img",5,0),_("load",function(){p(e);let n=c();return h(n.imageLoadedInView())})("mousedown",function(n){p(e);let o=c();return h(o.startMove(n,o.moveTypes.Drag))})("touchstart",function(n){p(e);let o=c();return h(o.startMove(n,o.moveTypes.Drag))})("error",function(n){p(e);let o=c();return h(o.loadImageError(n))}),m()}if(r&2){let e=t.ngIf,i=c();N("visibility",i.imageVisible?"visible":"hidden")("transform",i.safeTransformStyle()),X("ngx-ic-draggable",!i.disabled&&i.allowMoveImage),w("src",e,G),J("alt",i.imageAltText)}}function mt(r,t){if(r&1){let e=T();Ee(0),l(1,"span",9),_("mousedown",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"topleft"))})("touchstart",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"topleft"))}),I(2,"span",10),m(),l(3,"span",11),_("mousedown",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"topright"))})("touchstart",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"topright"))}),I(4,"span",10),m(),l(5,"span",12),_("mousedown",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"bottomright"))})("touchstart",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"bottomright"))}),I(6,"span",10),m(),l(7,"span",13),_("mousedown",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"bottomleft"))})("touchstart",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"bottomleft"))}),I(8,"span",10),m(),l(9,"span",14),_("mousedown",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"top"))})("touchstart",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"top"))}),m(),l(10,"span",15),_("mousedown",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"top"))})("touchstart",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"top"))}),I(11,"span",10),m(),l(12,"span",16),_("mousedown",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"right"))})("touchstart",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"right"))}),m(),l(13,"span",17),_("mousedown",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"right"))})("touchstart",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"right"))}),I(14,"span",10),m(),l(15,"span",18),_("mousedown",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"bottom"))})("touchstart",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"bottom"))}),m(),l(16,"span",19),_("mousedown",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"bottom"))})("touchstart",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"bottom"))}),I(17,"span",10),m(),l(18,"span",20),_("mousedown",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"left"))})("touchstart",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"left"))}),m(),l(19,"span",21),_("mousedown",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"left"))})("touchstart",function(n){p(e);let o=c(2);return h(o.startMove(n,o.moveTypes.Resize,"left"))}),I(20,"span",10),m(),Le()}}function dt(r,t){if(r&1){let e=T();l(0,"div",6),_("keydown",function(n){p(e);let o=c();return h(o.keyboardAccess(n))}),l(1,"div",7),_("mousedown",function(n){p(e);let o=c();return h(o.startMove(n,o.moveTypes.Move))})("touchstart",function(n){p(e);let o=c();return h(o.startMove(n,o.moveTypes.Move))}),m(),V(2,mt,21,0,"ng-container",8),m()}if(r&2){let e=c();N("top",e.state.cropper().y1,"px")("left",e.state.cropper().x1,"px")("width",e.state.cropper().x2-e.state.cropper().x1,"px")("height",e.state.cropper().y2-e.state.cropper().y1,"px")("margin-left",e.state.options.alignImage==="center"?e.marginLeft:null)("visibility",e.imageVisible?"visible":"hidden"),X("ngx-ic-round",e.state.options.roundCropper),J("aria-label",e.state.options.cropperFrameAriaLabel),g(2),w("ngIf",!e.state.options.hideResizeSquares&&!(e.state.options.cropperStaticWidth&&e.state.options.cropperStaticHeight))}}function oe(r,t,e){return r=gt(r,t),pe(r,t,e)}function gt(r,t){let e=r.x2-r.x1,i=r.y2-r.y1,n=r.x1+e/2,o=r.y1+i/2;t.options.cropperStaticHeight&&t.options.cropperStaticWidth?(e=t.maxSize().width>t.options.cropperStaticWidth?t.options.cropperStaticWidth:t.maxSize().width,i=t.maxSize().height>t.options.cropperStaticHeight?t.options.cropperStaticHeight:t.maxSize().height):(e=Math.max(t.cropperScaledMinWidth,Math.min(e,t.cropperScaledMaxWidth,t.maxSize().width)),i=Math.max(t.cropperScaledMinHeight,Math.min(i,t.cropperScaledMaxHeight,t.maxSize().height)),t.options.maintainAspectRatio&&(t.maxSize().width/t.options.aspectRatio<t.maxSize().height?i=e/t.options.aspectRatio:e=i*t.options.aspectRatio));let a=n-e/2,s=a+e,d=o-i/2,u=d+i;return{x1:a,x2:s,y1:d,y2:u}}function pe(r,t,e=!1){return r.x1<0&&(r=U(C({},r),{x1:0,x2:r.x2-(e?r.x1:0)})),r.y1<0&&(r=U(C({},r),{y2:r.y2-(e?r.y1:0),y1:0})),r.x2>t.maxSize().width&&(r=U(C({},r),{x1:r.x1-(e?r.x2-t.maxSize().width:0),x2:t.maxSize().width})),r.y2>t.maxSize().height&&(r=U(C({},r),{y1:r.y1-(e?r.y2-t.maxSize().height:0),y2:t.maxSize().height})),r}function _t(r,t){let e=he(r)-t.clientX,i=me(r)-t.clientY;return{x1:t.cropper.x1+e,y1:t.cropper.y1+i,x2:t.cropper.x2+e,y2:t.cropper.y2+i}}function et(r,t,e){let i=C({},e.cropper()),n=he(r)-t.clientX,o=me(r)-t.clientY;switch(t.position){case"left":i.x1=Math.min(Math.max(t.cropper.x1+n,i.x2-e.cropperScaledMaxWidth),i.x2-e.cropperScaledMinWidth);break;case"topleft":i.x1=Math.min(Math.max(t.cropper.x1+n,i.x2-e.cropperScaledMaxWidth),i.x2-e.cropperScaledMinWidth),i.y1=Math.min(Math.max(t.cropper.y1+o,i.y2-e.cropperScaledMaxHeight),i.y2-e.cropperScaledMinHeight);break;case"top":i.y1=Math.min(Math.max(t.cropper.y1+o,i.y2-e.cropperScaledMaxHeight),i.y2-e.cropperScaledMinHeight);break;case"topright":i.x2=Math.max(Math.min(t.cropper.x2+n,i.x1+e.cropperScaledMaxWidth),i.x1+e.cropperScaledMinWidth),i.y1=Math.min(Math.max(t.cropper.y1+o,i.y2-e.cropperScaledMaxHeight),i.y2-e.cropperScaledMinHeight);break;case"right":i.x2=Math.max(Math.min(t.cropper.x2+n,i.x1+e.cropperScaledMaxWidth),i.x1+e.cropperScaledMinWidth);break;case"bottomright":i.x2=Math.max(Math.min(t.cropper.x2+n,i.x1+e.cropperScaledMaxWidth),i.x1+e.cropperScaledMinWidth),i.y2=Math.max(Math.min(t.cropper.y2+o,i.y1+e.cropperScaledMaxHeight),i.y1+e.cropperScaledMinHeight);break;case"bottom":i.y2=Math.max(Math.min(t.cropper.y2+o,i.y1+e.cropperScaledMaxHeight),i.y1+e.cropperScaledMinHeight);break;case"bottomleft":i.x1=Math.min(Math.max(t.cropper.x1+n,i.x2-e.cropperScaledMaxWidth),i.x2-e.cropperScaledMinWidth),i.y2=Math.max(Math.min(t.cropper.y2+o,i.y1+e.cropperScaledMaxHeight),i.y1+e.cropperScaledMinHeight);break;case"center":let a="scale"in r?r.scale:1,s=Math.min(Math.max(e.cropperScaledMinWidth,Math.abs(t.cropper.x2-t.cropper.x1)*a),e.cropperScaledMaxWidth),d=Math.min(Math.max(e.cropperScaledMinHeight,Math.abs(t.cropper.y2-t.cropper.y1)*a),e.cropperScaledMaxHeight);i.x1=t.clientX-s/2,i.x2=t.clientX+s/2,i.y1=t.clientY-d/2,i.y2=t.clientY+d/2,i.x1<0?(i.x2-=i.x1,i.x1=0):i.x2>e.maxSize().width&&(i.x1-=i.x2-e.maxSize().width,i.x2=e.maxSize().width),i.y1<0?(i.y2-=i.y1,i.y1=0):i.y2>e.maxSize().height&&(i.y1-=i.y2-e.maxSize().height,i.y2=e.maxSize().height);break}return e.options.maintainAspectRatio?ut(t.position,i,e):i}function ut(r,t,e){t=C({},t);let i=0,n=0;switch(r){case"top":t.x2=t.x1+(t.y2-t.y1)*e.options.aspectRatio,i=Math.max(t.x2-e.maxSize().width,0),n=Math.max(0-t.y1,0),(i>0||n>0)&&(t.x2-=n*e.options.aspectRatio>i?n*e.options.aspectRatio:i,t.y1+=n*e.options.aspectRatio>i?n:i/e.options.aspectRatio);break;case"bottom":t.x2=t.x1+(t.y2-t.y1)*e.options.aspectRatio,i=Math.max(t.x2-e.maxSize().width,0),n=Math.max(t.y2-e.maxSize().height,0),(i>0||n>0)&&(t.x2-=n*e.options.aspectRatio>i?n*e.options.aspectRatio:i,t.y2-=n*e.options.aspectRatio>i?n:i/e.options.aspectRatio);break;case"topleft":t.y1=t.y2-(t.x2-t.x1)/e.options.aspectRatio,i=Math.max(0-t.x1,0),n=Math.max(0-t.y1,0),(i>0||n>0)&&(t.x1+=n*e.options.aspectRatio>i?n*e.options.aspectRatio:i,t.y1+=n*e.options.aspectRatio>i?n:i/e.options.aspectRatio);break;case"topright":t.y1=t.y2-(t.x2-t.x1)/e.options.aspectRatio,i=Math.max(t.x2-e.maxSize().width,0),n=Math.max(0-t.y1,0),(i>0||n>0)&&(t.x2-=n*e.options.aspectRatio>i?n*e.options.aspectRatio:i,t.y1+=n*e.options.aspectRatio>i?n:i/e.options.aspectRatio);break;case"right":case"bottomright":t.y2=t.y1+(t.x2-t.x1)/e.options.aspectRatio,i=Math.max(t.x2-e.maxSize().width,0),n=Math.max(t.y2-e.maxSize().height,0),(i>0||n>0)&&(t.x2-=n*e.options.aspectRatio>i?n*e.options.aspectRatio:i,t.y2-=n*e.options.aspectRatio>i?n:i/e.options.aspectRatio);break;case"left":case"bottomleft":t.y2=t.y1+(t.x2-t.x1)/e.options.aspectRatio,i=Math.max(0-t.x1,0),n=Math.max(t.y2-e.maxSize().height,0),(i>0||n>0)&&(t.x1+=n*e.options.aspectRatio>i?n*e.options.aspectRatio:i,t.y2-=n*e.options.aspectRatio>i?n:i/e.options.aspectRatio);break;case"center":t.x2=t.x1+(t.y2-t.y1)*e.options.aspectRatio,t.y2=t.y1+(t.x2-t.x1)/e.options.aspectRatio;let o=Math.max(0-t.x1,0),a=Math.max(t.x2-e.maxSize().width,0),s=Math.max(t.y2-e.maxSize().height,0),d=Math.max(0-t.y1,0);(o>0||a>0||s>0||d>0)&&(t.x1+=s*e.options.aspectRatio>o?s*e.options.aspectRatio:o,t.x2-=d*e.options.aspectRatio>a?d*e.options.aspectRatio:a,t.y1+=d*e.options.aspectRatio>a?d:a/e.options.aspectRatio,t.y2-=s*e.options.aspectRatio>o?s:o/e.options.aspectRatio);break}return t}function he(r){return"touches"in r&&r.touches[0]?r.touches[0].clientX:"clientX"in r?r.clientX:0}function me(r){return"touches"in r&&r.touches[0]?r.touches[0].clientY:"clientX"in r?r.clientY:0}var ye=class{constructor(){this.cropper=K({x1:0,x2:0,y1:0,y2:0}),this.maxSize=K({width:0,height:0}),this.transform={},this.options={format:"png",output:"blob",autoCrop:!0,maintainAspectRatio:!0,aspectRatio:1,resetCropOnAspectRatioChange:!0,resizeToWidth:0,resizeToHeight:0,cropperMinWidth:0,cropperMinHeight:0,cropperMaxHeight:0,cropperMaxWidth:0,cropperStaticWidth:0,cropperStaticHeight:0,canvasRotation:0,roundCropper:!1,onlyScaleDown:!1,imageQuality:92,backgroundColor:void 0,containWithinAspectRatio:!1,hideResizeSquares:!1,alignImage:"center",cropperFrameAriaLabel:void 0,checkImageType:!0},this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20,this.cropperScaledMaxWidth=20,this.cropperScaledMaxHeight=20,this.stepSize=3}setOptionsFromChanges(t){t.options?.currentValue&&this.setOptions(t.options.currentValue);let e=Object.entries(t).filter(([i])=>i in this.options).reduce((i,[n,o])=>U(C({},i),{[n]:o.currentValue}),{});Object.keys(e).length>0&&this.setOptions(e)}setOptions(t){if(this.options=C(C({},this.options),t||{}),this.validateOptions(),!this.loadedImage?.transformed.image.complete||!this.maxSize)return;let e=!1;this.options.maintainAspectRatio&&t.aspectRatio||"maintainAspectRatio"in t?(this.setCropperScaledMinSize(),this.setCropperScaledMaxSize(),this.options.maintainAspectRatio&&(this.options.resetCropOnAspectRatioChange||!this.aspectRatioIsCorrect())&&(this.cropper.set(this.maxSizeCropperPosition()),e=!0)):((t.cropperMinWidth||t.cropperMinHeight)&&(this.setCropperScaledMinSize(),e=!0),(t.cropperMaxWidth||t.cropperMaxHeight)&&(this.setCropperScaledMaxSize(),e=!0),(t.cropperStaticWidth||t.cropperStaticHeight)&&(e=!0)),e&&this.cropper.update(i=>oe(i,this,!1))}validateOptions(){if(this.options.maintainAspectRatio&&!this.options.aspectRatio)throw new Error("`aspectRatio` should > 0 when `maintainAspectRatio` is enabled")}setMaxSize(t,e){this.maxSize.set({width:t,height:e}),this.setCropperScaledMinSize(),this.setCropperScaledMaxSize()}setCropperScaledMinSize(){this.loadedImage?.transformed.size?(this.setCropperScaledMinWidth(),this.setCropperScaledMinHeight()):(this.cropperScaledMinWidth=20,this.cropperScaledMinHeight=20)}setCropperScaledMinWidth(){this.cropperScaledMinWidth=this.options.cropperMinWidth>0?Math.max(20,this.options.cropperMinWidth/this.loadedImage.transformed.size.width*this.maxSize().width):20}setCropperScaledMinHeight(){this.options.maintainAspectRatio?this.cropperScaledMinHeight=Math.max(20,this.cropperScaledMinWidth/this.options.aspectRatio):this.options.cropperMinHeight>0?this.cropperScaledMinHeight=Math.max(20,this.options.cropperMinHeight/this.loadedImage.transformed.size.height*this.maxSize().height):this.cropperScaledMinHeight=20}setCropperScaledMaxSize(){if(this.loadedImage?.transformed.size){let t=this.loadedImage.transformed.size.width/this.maxSize().width;this.cropperScaledMaxWidth=this.options.cropperMaxWidth>20?this.options.cropperMaxWidth/t:this.maxSize().width,this.cropperScaledMaxHeight=this.options.cropperMaxHeight>20?this.options.cropperMaxHeight/t:this.maxSize().height,this.options.maintainAspectRatio&&(this.cropperScaledMaxWidth>this.cropperScaledMaxHeight*this.options.aspectRatio?this.cropperScaledMaxWidth=this.cropperScaledMaxHeight*this.options.aspectRatio:this.cropperScaledMaxWidth<this.cropperScaledMaxHeight*this.options.aspectRatio&&(this.cropperScaledMaxHeight=this.cropperScaledMaxWidth/this.options.aspectRatio))}else this.cropperScaledMaxWidth=this.maxSize().width,this.cropperScaledMaxHeight=this.maxSize().height}equalsCropperPosition(t){let e=this.cropper();return e==null&&t==null||e!=null&&t!=null&&e.x1.toFixed(3)===t.x1.toFixed(3)&&e.y1.toFixed(3)===t.y1.toFixed(3)&&e.x2.toFixed(3)===t.x2.toFixed(3)&&e.y2.toFixed(3)===t.y2.toFixed(3)}equalsTransformTranslate(t){return(this.transform.translateH??0)===(t.translateH??0)&&(this.transform.translateV??0)===(t.translateV??0)}equalsTransform(t){return this.equalsTransformTranslate(t)&&(this.transform.scale??1)===(t.scale??1)&&(this.transform.rotate??0)===(t.rotate??0)&&(this.transform.flipH??!1)===(t.flipH??!1)&&(this.transform.flipV??!1)===(t.flipV??!1)}aspectRatioIsCorrect(){let t=this.cropper();return(t.x2-t.x1)/(t.y2-t.y1)===this.options.aspectRatio}resizeCropperPosition(t){(t.width!==this.maxSize().width||t.height!==this.maxSize().height)&&this.cropper.update(e=>({x1:e.x1*this.maxSize().width/t.width,x2:e.x2*this.maxSize().width/t.width,y1:e.y1*this.maxSize().height/t.height,y2:e.y2*this.maxSize().height/t.height}))}maxSizeCropperPosition(){return{x1:0,y1:0,x2:this.maxSize().width,y2:this.maxSize().height}}toCropInput(){return{cropper:this.cropper(),maxSize:this.maxSize(),transform:this.transform,loadedImage:this.loadedImage,options:C({},this.options)}}},R=(function(r){return r.Drag="drag",r.Move="move",r.Resize="resize",r.Pinch="pinch",r})(R||{});function ft(r,t,e){let i=r.width,n=r.height;t=Math.round(t),e=Math.round(e);let o=i/t,a=n/e,s=Math.ceil(o/2),d=Math.ceil(a/2),u=r.getContext("2d");if(u){let S=u.getImageData(0,0,i,n),b=u.createImageData(t,e),f=S.data,x=b.data;for(let O=0;O<e;O++)for(let L=0;L<t;L++){let re=(L+O*t)*4,ot=O*a,P=0,ae=0,Ie=0,ze=0,Re=0,Te=0,Se=0,rt=Math.floor(L*o),at=Math.floor(O*a),de=Math.ceil((L+1)*o),ge=Math.ceil((O+1)*a);de=Math.min(de,i),ge=Math.min(ge,n);for(let se=at;se<ge;se++){let Oe=Math.abs(ot-se)/d,st=L*o,ct=Oe*Oe;for(let ce=rt;ce<de;ce++){let Fe=Math.abs(st-ce)/s,B=Math.sqrt(ct+Fe*Fe);if(B>=1)continue;P=2*B*B*B-3*B*B+1;let j=4*(ce+se*i);Se+=P*f[j+3],Ie+=P,f[j+3]<255&&(P=P*f[j+3]/250),ze+=P*f[j],Re+=P*f[j+1],Te+=P*f[j+2],ae+=P}}x[re]=ze/ae,x[re+1]=Re/ae,x[re+2]=Te/ae,x[re+3]=Se/Ie}r.width=t,r.height=e,u.putImageData(b,0,0)}}function tt(r,t){return r/100*t}var be=class{crop(t,e){let i=this.getImagePosition(t),n=i.x2-i.x1,o=i.y2-i.y1,a=document.createElement("canvas");a.width=n,a.height=o;let s=a.getContext("2d");if(!s)return null;t.options?.backgroundColor!=null&&(s.fillStyle=t.options.backgroundColor,s.fillRect(0,0,n,o));let d=(t.transform?.scale||1)*(t.transform?.flipH?-1:1),u=(t.transform?.scale||1)*(t.transform?.flipV?-1:1),{translateH:S,translateV:b}=this.getCanvasTranslate(t),f=t.loadedImage.transformed;s.setTransform(d,0,0,u,f.size.width/2+S,f.size.height/2+b),s.translate(-i.x1/d,-i.y1/u),s.rotate((t.transform?.rotate||0)*Math.PI/180),s.drawImage(f.image,-f.size.width/2,-f.size.height/2);let x={width:n,height:o,imagePosition:i,cropperPosition:C({},t.cropper)};t.options?.containWithinAspectRatio&&(x.offsetImagePosition=this.getOffsetImagePosition(t));let O=this.getResizeRatio(n,o,t.options);return O!==1&&(x.width=Math.round(n*O),x.height=t.options?.maintainAspectRatio?Math.round(x.width/(t.options?.aspectRatio??1)):Math.round(o*O),ft(a,x.width,x.height)),e==="blob"?this.cropToBlob(x,a,t):(x.base64=a.toDataURL("image/"+(t.options?.format??"png"),this.getQuality(t.options)),x)}cropToBlob(t,e,i){return M(this,null,function*(){return t.blob=yield new Promise(n=>e.toBlob(n,"image/"+(i.options?.format??"png"),this.getQuality(i.options))),t.blob&&(t.objectUrl=URL.createObjectURL(t.blob)),t})}getCanvasTranslate(t){if(t.transform?.translateUnit==="px"){let e=this.getRatio(t);return{translateH:(t.transform?.translateH||0)*e,translateV:(t.transform?.translateV||0)*e}}else return{translateH:t.transform?.translateH?tt(t.transform.translateH,t.loadedImage.transformed.size.width):0,translateV:t.transform?.translateV?tt(t.transform.translateV,t.loadedImage.transformed.size.height):0}}getRatio(t){return t.loadedImage.transformed.size.width/t.maxSize.width}getImagePosition(t){let e=this.getRatio(t),i={x1:Math.round(t.cropper.x1*e),y1:Math.round(t.cropper.y1*e),x2:Math.round(t.cropper.x2*e),y2:Math.round(t.cropper.y2*e)};return t.options?.containWithinAspectRatio||(i.x1=Math.max(i.x1,0),i.y1=Math.max(i.y1,0),i.x2=Math.min(i.x2,t.loadedImage.transformed.size.width),i.y2=Math.min(i.y2,t.loadedImage.transformed.size.height)),i}getOffsetImagePosition(t){let e=(t.options?.canvasRotation??0)+t.loadedImage.exifTransform.rotate,i=this.getRatio(t),n,o;e%2?(n=(t.loadedImage.transformed.size.width-t.loadedImage.original.size.height)/2,o=(t.loadedImage.transformed.size.height-t.loadedImage.original.size.width)/2):(n=(t.loadedImage.transformed.size.width-t.loadedImage.original.size.width)/2,o=(t.loadedImage.transformed.size.height-t.loadedImage.original.size.height)/2);let a=t.cropper,s={x1:Math.round(a.x1*i)-n,y1:Math.round(a.y1*i)-o,x2:Math.round(a.x2*i)-n,y2:Math.round(a.y2*i)-o};return t.options?.containWithinAspectRatio||(s.x1=Math.max(s.x1,0),s.y1=Math.max(s.y1,0),s.x2=Math.min(s.x2,t.loadedImage.transformed.size.width),s.y2=Math.min(s.y2,t.loadedImage.transformed.size.height)),s}getResizeRatio(t,e,i){let n=new Array;i?.resizeToWidth&&i.resizeToWidth>0&&n.push(i.resizeToWidth/t),i?.resizeToHeight&&i.resizeToHeight>0&&n.push(i.resizeToHeight/e);let o=n.length===0?1:Math.min(...n);return o>1&&!i?.onlyScaleDown?o:Math.min(o,1)}getQuality(t){return Math.min(1,Math.max(0,(t?.imageQuality??92)/100))}},xt=[new Uint8Array([255,216,255,225,0,34,69,120,105,102,0,0,77,77,0,42,0,0,0,8,0,1,1,18,0,3,0,0,0,1,0,6,0,0,0,0,0,0,255,219,0,132,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,255,192,0,17,8,0,1,0,2,3,1,17,0,2,17,1,3,17,1,255,196,0,74,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,11,16,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,17,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,218,0,12,3,1,0,2,17,3,17,0,63,0,63,240,127,255,217])],Ct=URL.createObjectURL(new Blob(xt,{type:"image/jpeg"}));function wt(){return new Promise(r=>{let t=new Image;t.onload=()=>{let e=t.width===1&&t.height===2;r(e)},t.src=Ct})}function Mt(r){switch(typeof r=="object"&&(r=yt(r)),r){case 2:return{rotate:0,flip:!0};case 3:return{rotate:2,flip:!1};case 4:return{rotate:2,flip:!0};case 5:return{rotate:1,flip:!0};case 6:return{rotate:1,flip:!1};case 7:return{rotate:3,flip:!0};case 8:return{rotate:3,flip:!1};default:return{rotate:0,flip:!1}}}function yt(r){let t=new DataView(r);if(t.getUint16(0,!1)!==65496)return-2;let e=t.byteLength,i=2;for(;i<e;){if(t.getUint16(i+2,!1)<=8)return-1;let n=t.getUint16(i,!1);if(i+=2,n==65505){if(t.getUint32(i+=2,!1)!==1165519206)return-1;let o=t.getUint16(i+=6,!1)==18761;i+=t.getUint32(i+4,o);let a=t.getUint16(i,o);i+=2;for(let s=0;s<a;s++)if(t.getUint16(i+s*12,o)==274)return t.getUint16(i+s*12+8,o)}else{if((n&65280)!==65280)break;i+=t.getUint16(i,!1)}}return-1}var ve=class{constructor(){this.autoRotateSupported=wt()}loadImageFile(t,e){return M(this,null,function*(){let i=yield t.arrayBuffer();return e.checkImageType?yield this.checkImageTypeAndLoadImageFromArrayBuffer(i,t.type,e):yield this.loadImageFromArrayBuffer(i,e)})}checkImageTypeAndLoadImageFromArrayBuffer(t,e,i){return this.isValidImageType(e)?this.loadImageFromArrayBuffer(t,i,e):Promise.reject(new Error("Invalid image type"))}isValidImageType(t){return/image\/(png|jpg|jpeg|heic|bmp|gif|tiff|svg|webp|x-icon|vnd.microsoft.icon)/.test(t)}loadImageFromURL(t,e){return M(this,null,function*(){let n=yield(yield fetch(t)).blob(),o=yield n.arrayBuffer();return yield this.loadImageFromArrayBuffer(o,e,n.type)})}loadBase64Image(t,e){let i=this.base64ToArrayBuffer(t);return this.loadImageFromArrayBuffer(i,e)}base64ToArrayBuffer(t){t=t.replace(/^data:([^;]+);base64,/gmi,"");let e=atob(t),i=e.length,n=new Uint8Array(i);for(let o=0;o<i;o++)n[o]=e.charCodeAt(o);return n.buffer}loadImageFromArrayBuffer(t,e,i){return M(this,null,function*(){let n=yield new Promise((o,a)=>M(this,null,function*(){try{let s=new Blob([t],i?{type:i}:void 0),d=URL.createObjectURL(s),u=new Image,b=i==="image/svg+xml"?yield this.getSvgImageSize(s):void 0;u.onload=()=>o({originalImage:u,originalImageSize:b,originalObjectUrl:d,originalArrayBuffer:t}),u.onerror=a,u.src=d}catch(s){a(s)}}));return yield this.transformImageFromArrayBuffer(n,e,n.originalImageSize!=null)})}getSvgImageSize(t){return M(this,null,function*(){let n=new DOMParser().parseFromString(yield t.text(),"image/svg+xml").querySelector("svg");if(!n)throw Error("Failed to parse SVG image");let o=n.getAttribute("width"),a=n.getAttribute("height");if(o&&a)return null;let s=n.getAttribute("viewBox")||n.getAttribute("viewbox");if(s){let d=s.split(" ");return{width:+d[2],height:+d[3]}}throw Error("Failed to load SVG image. SVG must have width + height or viewBox definition.")})}transformImageFromArrayBuffer(t,e,i=!1){return M(this,null,function*(){let n=yield this.autoRotateSupported,o=Mt(n?-1:t.originalArrayBuffer);if(!t.originalImage||!t.originalImage.complete)return Promise.reject(new Error("No image loaded"));let a={original:{objectUrl:t.originalObjectUrl,image:t.originalImage,size:t.originalImageSize??{width:t.originalImage.naturalWidth,height:t.originalImage.naturalHeight}},exifTransform:o};return this.transformLoadedImage(a,e,i)})}transformLoadedImage(t,e,i=!1){return M(this,null,function*(){let n=(e.canvasRotation??0)+t.exifTransform.rotate,o=t.original.size;if(!i&&n===0&&!t.exifTransform.flip&&!e.containWithinAspectRatio)return{original:{objectUrl:t.original.objectUrl,image:t.original.image,size:C({},o)},transformed:{objectUrl:t.original.objectUrl,image:t.original.image,size:C({},o)},exifTransform:t.exifTransform};let a=this.getTransformedSize(o,t.exifTransform,e),s=document.createElement("canvas");s.width=a.width,s.height=a.height;let d=s.getContext("2d");d?.setTransform(t.exifTransform.flip?-1:1,0,0,1,s.width/2,s.height/2),d?.rotate(Math.PI*(n/2)),d?.drawImage(t.original.image,-o.width/2,-o.height/2);let u=yield new Promise(f=>s.toBlob(f,"image/"+(e.format??"png")));if(!u)throw new Error("Failed to get Blob for transformed image.");let S=URL.createObjectURL(u),b=yield this.loadImageFromObjectUrl(S);return{original:{objectUrl:t.original.objectUrl,image:t.original.image,size:C({},o)},transformed:{objectUrl:S,image:b,size:{width:b.width,height:b.height}},exifTransform:t.exifTransform}})}loadImageFromObjectUrl(t){return new Promise((e,i)=>{let n=new Image;n.onload=()=>e(n),n.onerror=i,n.src=t})}getTransformedSize(t,e,i){let n=(i.canvasRotation??0)+e.rotate;if(i.containWithinAspectRatio)if(n%2){let o=t.width*(i.aspectRatio??1),a=t.height/(i.aspectRatio??1);return{width:Math.max(t.height,o),height:Math.max(t.width,a)}}else{let o=t.height*(i.aspectRatio??1),a=t.width/(i.aspectRatio??1);return{width:Math.max(t.width,o),height:Math.max(t.height,a)}}return n%2?{height:t.width,width:t.height}:{width:t.width,height:t.height}}};function bt(r){switch(r){case"ArrowUp":return"top";case"ArrowRight":return"right";case"ArrowDown":return"bottom";case"ArrowLeft":default:return"left"}}function vt(r){switch(r){case"ArrowUp":return"bottom";case"ArrowRight":return"left";case"ArrowDown":return"top";case"ArrowLeft":default:return"right"}}function It(r,t){switch(r){case"ArrowUp":return{clientX:0,clientY:t*-1};case"ArrowRight":return{clientX:t,clientY:0};case"ArrowDown":return{clientX:0,clientY:t};case"ArrowLeft":default:return{clientX:t*-1,clientY:0}}}var it=(()=>{class r{get alignImageStyle(){return this.state.options.alignImage}constructor(e){this.sanitizer=e,this.pinchStart$=new Pe,this.cropService=new be,this.loadImageService=new ve,this.setImageMaxSizeRetries=0,this.resizedWhileHidden=!1,this.moveTypes=R,this.state=new ye,this.safeImgDataUrl=K(void 0),this.safeTransformStyle=K(void 0),this.marginLeft="0px",this.imageVisible=!1,this.allowMoveImage=!1,this.checkImageType=!0,this.disabled=!1,this.hidden=!1,this.imageCropped=D(),this.startCropImage=D(),this.imageLoaded=D(),this.cropperReady=D(),this.loadImageFailed=D(),this.transformChange=D(),this.cropperChange=D(),this.reset()}ngOnInit(){this.state.stepSize=this.initialStepSize||this.state.stepSize}ngOnChanges(e){let i=this.state.cropper(),n=this.state.transform,o=this.state.options.backgroundColor;if(this.state.setOptionsFromChanges(e),this.onChangesInputImage(e),e.transform&&this.transform&&(this.state.transform=this.transform,this.setCssTransform()),!this.state.loadedImage?.transformed.image.complete||!this.state.maxSize)return;if(this.containWithinAspectRatio&&e.aspectRatio||e.containWithinAspectRatio||e.canvasRotation){this.loadImageService.transformLoadedImage(this.state.loadedImage,this.state.options).then(s=>this.setLoadedImage(s)).catch(s=>this.loadImageError(s));return}e.cropper&&this.cropper&&this.state.cropper.set(oe(this.cropper,this.state,!0));let a=!this.state.equalsCropperPosition(i);a&&(!this.cropper||!this.state.equalsCropperPosition(this.cropper))&&this.cropperChange.emit(this.state.cropper()),(a||!this.state.equalsTransform(n)||this.state.options.backgroundColor!==o)&&this.doAutoCrop(),e.hidden&&this.resizedWhileHidden&&!this.hidden&&setTimeout(()=>{this.onResize(),this.resizedWhileHidden=!1})}onChangesInputImage(e){(e.imageChangedEvent||e.imageURL||e.imageBase64||e.imageFile)&&this.reset(),e.imageChangedEvent&&this.isValidImageChangedEvent()&&this.loadImageFile(this.imageChangedEvent.target.files[0]),e.imageURL&&this.imageURL&&this.loadImageFromURL(this.imageURL),e.imageBase64&&this.imageBase64&&this.loadBase64Image(this.imageBase64),e.imageFile&&this.imageFile&&this.loadImageFile(this.imageFile)}isValidImageChangedEvent(){let e=this.imageChangedEvent?.target?.files;return e instanceof FileList&&e.length>0}reset(){this.state.loadedImage=void 0,this.state.maxSize.set({width:0,height:0}),this.imageVisible=!1}loadImageFile(e){this.loadImageService.loadImageFile(e,this.state.options).then(i=>this.setLoadedImage(i)).catch(i=>this.loadImageError(i))}loadBase64Image(e){this.loadImageService.loadBase64Image(e,this.state.options).then(i=>this.setLoadedImage(i)).catch(i=>this.loadImageError(i))}loadImageFromURL(e){this.loadImageService.loadImageFromURL(e,this.state.options).then(i=>this.setLoadedImage(i)).catch(i=>this.loadImageError(i))}setLoadedImage(e){this.state.loadedImage=e,this.safeImgDataUrl.set(this.sanitizer.bypassSecurityTrustResourceUrl(e.transformed.objectUrl))}loadImageError(e){console.error(e),this.loadImageFailed.emit()}setCssTransform(){let e=this.state.transform?.translateUnit||"%";this.safeTransformStyle.set(this.sanitizer.bypassSecurityTrustStyle(`translate(${this.state.transform.translateH||0}${e}, ${this.state.transform.translateV||0}${e}) scaleX(`+(this.state.transform.scale||1)*(this.state.transform.flipH?-1:1)+") scaleY("+(this.state.transform.scale||1)*(this.state.transform.flipV?-1:1)+") rotate("+(this.state.transform.rotate||0)+"deg)"))}imageLoadedInView(){this.state.loadedImage!=null&&(this.imageLoaded.emit(this.state.loadedImage),this.setImageMaxSizeRetries=0,setTimeout(()=>this.checkImageMaxSizeRecursively()))}checkImageMaxSizeRecursively(){this.setImageMaxSizeRetries>40?this.loadImageFailed.emit():this.sourceImageLoaded()?(this.setMaxSize(),this.cropper&&(!this.maintainAspectRatio||this.state.aspectRatioIsCorrect())?(this.state.cropper.set(oe(this.cropper,this.state,!0)),this.emitCropperPositionChange(this.cropper)):(this.state.cropper.set(oe(this.state.maxSizeCropperPosition(),this.state,!0)),this.cropperChange.emit(this.state.cropper())),this.imageVisible=!0,this.cropperReady.emit(this.state.maxSize()),this.doAutoCrop()):(this.setImageMaxSizeRetries++,setTimeout(()=>this.checkImageMaxSizeRecursively(),50))}sourceImageLoaded(){return this.sourceImage?.nativeElement?.offsetWidth>1}onResize(){if(this.state.loadedImage)if(this.hidden)this.resizedWhileHidden=!0;else{let e=this.state.maxSize();this.setMaxSize(),this.state.resizeCropperPosition(e)}}keyboardAccess(e){this.changeKeyboardStepSize(e),this.keyboardMoveCropper(e)}changeKeyboardStepSize(e){let i=+e.key;i>=1&&i<=9&&(this.state.stepSize=i)}keyboardMoveCropper(e){if(!["ArrowUp","ArrowDown","ArrowRight","ArrowLeft"].includes(e.key))return;let n=e.shiftKey?R.Resize:R.Move,o=e.altKey?vt(e.key):bt(e.key),a=It(e.key,this.state.stepSize);e.preventDefault(),e.stopPropagation(),this.moveStart={type:n,position:o,clientX:0,clientY:0,transform:this.state.transform,cropper:this.state.cropper()},this.handleMouseMove(a),this.handleMouseUp()}startMove(e,i,n=null){this.disabled||this.moveStart&&this.moveStart.type===R.Pinch||i===R.Drag&&!this.allowMoveImage||("preventDefault"in e&&e.preventDefault(),this.moveStart={type:i,position:n,clientX:he(e),clientY:me(e),transform:this.state.transform,cropper:this.state.cropper()},this.initMouseMove())}initMouseMove(){_e(E(document,"mousemove"),E(document,"touchmove")).pipe(ue(_e(E(document,"mouseup"),E(document,"touchend"),this.pinchStart$).pipe(Ve()))).subscribe({next:e=>this.handleMouseMove(e),complete:()=>this.handleMouseUp()})}handleMouseMove(e){if(this.moveStart){if("stopPropagation"in e&&e.stopPropagation(),"preventDefault"in e&&e.preventDefault(),this.moveStart.type===R.Move)this.state.cropper.set(pe(_t(e,this.moveStart),this.state,!0));else if(this.moveStart.type===R.Resize)!this.cropperStaticWidth&&!this.cropperStaticHeight&&this.state.cropper.set(pe(et(e,this.moveStart,this.state),this.state,!1));else if(this.moveStart.type===R.Drag){let i=he(e)-this.moveStart.clientX,n=me(e)-this.moveStart.clientY;this.state.transform=U(C({},this.state.transform),{translateH:(this.moveStart.transform?.translateH||0)+i,translateV:(this.moveStart.transform?.translateV||0)+n}),this.setCssTransform()}}}handleMouseUp(){!this.moveStart||this.moveStart.type===R.Pinch||((!this.state.equalsCropperPosition(this.moveStart.cropper)||this.moveStart.transform&&!this.state.equalsTransform(this.moveStart.transform))&&(this.moveStart.type===R.Drag?this.transformChange.emit(this.state.transform):this.cropperChange.emit(this.state.cropper()),this.doAutoCrop()),this.moveStart=void 0)}startPinch(e){if(this.disabled||!this.sourceImageLoaded()||e.touches.length<2)return;"preventDefault"in e&&e.preventDefault();let i=this.state.cropper();this.moveStart={type:R.Pinch,position:"center",clientX:i.x1+(i.x2-i.x1)/2,clientY:i.y1+(i.y2-i.y1)/2,cropper:i},this.initPinch()}initPinch(){this.pinchStart$.next(),E(document,"touchmove").pipe(ue(E(document,"touchend"))).subscribe({next:e=>this.handlePinchMove(e),complete:()=>this.handlePinchStop()})}handlePinchMove(e){this.moveStart&&(e.preventDefault&&e.preventDefault(),this.moveStart.type===R.Pinch&&!this.cropperStaticWidth&&!this.cropperStaticHeight&&this.state.cropper.set(pe(et(e,this.moveStart,this.state),this.state,!1)))}handlePinchStop(){this.moveStart&&(this.state.equalsCropperPosition(this.moveStart.cropper)||(this.emitCropperPositionChange(this.moveStart.cropper),this.doAutoCrop()),this.moveStart=void 0)}setMaxSize(){if(this.sourceImage){let e=getComputedStyle(this.sourceImage.nativeElement);this.state.setMaxSize(parseFloat(e.width),parseFloat(e.height)),this.marginLeft=this.sanitizer.bypassSecurityTrustStyle("calc(50% - "+this.state.maxSize().width/2+"px)")}}emitCropperPositionChange(e){this.state.equalsCropperPosition(e)||this.cropperChange.emit(this.state.cropper())}doAutoCrop(){this.state.options.autoCrop&&this.crop()}crop(e=this.state.options.output){if(this.state.loadedImage?.transformed?.image!=null){if(this.startCropImage.emit(),e==="blob")return this.cropToBlob();if(e==="base64")return this.cropToBase64()}return null}cropToBlob(){return new Promise((e,i)=>M(this,null,function*(){let n=yield this.cropService.crop(this.state.toCropInput(),"blob");n?(this.imageCropped.emit(n),e(n)):i("Crop image failed")}))}cropToBase64(){let e=this.cropService.crop(this.state.toCropInput(),"base64");return e?(this.imageCropped.emit(e),e):null}resetCropperPosition(){this.state.cropper.set(oe(this.state.maxSizeCropperPosition(),this.state,!0)),this.cropperChange.emit(this.state.cropper())}ngOnDestroy(){this.pinchStart$.complete()}static{this.\u0275fac=function(i){return new(i||r)(Ae($e))}}static{this.\u0275cmp=q({type:r,selectors:[["image-cropper"]],viewQuery:function(i,n){if(i&1&&Be(lt,7)(pt,5),i&2){let o;fe(o=xe())&&(n.wrapper=o.first),fe(o=xe())&&(n.sourceImage=o.first)}},hostVars:6,hostBindings:function(i,n){i&1&&_("resize",function(){return n.onResize()},le),i&2&&(N("text-align",n.alignImageStyle),X("disabled",n.disabled)("ngx-ic-hidden",n.hidden))},inputs:{imageChangedEvent:"imageChangedEvent",imageURL:"imageURL",imageBase64:"imageBase64",imageFile:"imageFile",imageAltText:"imageAltText",options:"options",cropperFrameAriaLabel:"cropperFrameAriaLabel",output:"output",format:"format",autoCrop:"autoCrop",cropper:"cropper",transform:"transform",maintainAspectRatio:"maintainAspectRatio",aspectRatio:"aspectRatio",resetCropOnAspectRatioChange:"resetCropOnAspectRatioChange",resizeToWidth:"resizeToWidth",resizeToHeight:"resizeToHeight",cropperMinWidth:"cropperMinWidth",cropperMinHeight:"cropperMinHeight",cropperMaxHeight:"cropperMaxHeight",cropperMaxWidth:"cropperMaxWidth",cropperStaticWidth:"cropperStaticWidth",cropperStaticHeight:"cropperStaticHeight",canvasRotation:"canvasRotation",initialStepSize:"initialStepSize",roundCropper:"roundCropper",onlyScaleDown:"onlyScaleDown",imageQuality:"imageQuality",backgroundColor:"backgroundColor",containWithinAspectRatio:"containWithinAspectRatio",hideResizeSquares:"hideResizeSquares",allowMoveImage:"allowMoveImage",checkImageType:"checkImageType",alignImage:"alignImage",disabled:"disabled",hidden:"hidden"},outputs:{imageCropped:"imageCropped",startCropImage:"startCropImage",imageLoaded:"imageLoaded",cropperReady:"cropperReady",loadImageFailed:"loadImageFailed",transformChange:"transformChange",cropperChange:"cropperChange"},features:[He],decls:4,vars:10,consts:[["sourceImage",""],[3,"touchstart"],["class","ngx-ic-source-image","role","presentation",3,"src","visibility","transform","ngx-ic-draggable","load","mousedown","touchstart","error",4,"ngIf"],[1,"ngx-ic-overlay"],["class","ngx-ic-cropper","tabindex","0",3,"ngx-ic-round","top","left","width","height","margin-left","visibility","keydown",4,"ngIf"],["role","presentation",1,"ngx-ic-source-image",3,"load","mousedown","touchstart","error","src"],["tabindex","0",1,"ngx-ic-cropper",3,"keydown"],["role","presentation",1,"ngx-ic-move",3,"mousedown","touchstart"],[4,"ngIf"],["role","presentation",1,"ngx-ic-resize","ngx-ic-topleft",3,"mousedown","touchstart"],[1,"ngx-ic-square"],["role","presentation",1,"ngx-ic-resize","ngx-ic-topright",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize","ngx-ic-bottomright",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize","ngx-ic-bottomleft",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-top",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-top",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-right",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-right",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-bottom",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-bottom",3,"mousedown","touchstart"],["role","presentation",1,"ngx-ic-resize-bar","ngx-ic-left",3,"mousedown","touchstart"],[1,"ngx-ic-resize","ngx-ic-left",3,"mousedown","touchstart"]],template:function(i,n){i&1&&(l(0,"div",1),_("touchstart",function(a){return n.startPinch(a)}),V(1,ht,2,8,"img",2),I(2,"div",3),V(3,dt,3,16,"div",4),m()),i&2&&(N("background",n.imageVisible&&n.state.options.backgroundColor),g(),w("ngIf",n.safeImgDataUrl()),g(),N("width",n.state.maxSize().width||0,"px")("height",n.state.maxSize().height||0,"px")("margin-left",n.state.options.alignImage==="center"?n.marginLeft:null),g(),w("ngIf",n.imageVisible))},dependencies:[Xe],styles:['[_nghost-%COMP%]{display:flex;position:relative;width:100%;max-width:100%;max-height:100%;overflow:hidden;padding:5px;text-align:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]{width:100%;position:relative}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image[_ngcontent-%COMP%]{display:inline;max-width:100%;max-height:100%;transform-origin:center}[_nghost-%COMP%] > div[_ngcontent-%COMP%]   img.ngx-ic-source-image.ngx-ic-draggable[_ngcontent-%COMP%]{user-drag:none;-webkit-user-drag:none;user-select:none;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;cursor:grab}[_nghost-%COMP%]   .ngx-ic-overlay[_ngcontent-%COMP%]{position:absolute;pointer-events:none;touch-action:none;outline:var(--cropper-overlay-color, white) solid 100vw;top:0;left:0}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{position:absolute;display:flex;color:var(--cropper-color, #53535C);background:transparent;outline:var(--cropper-outline-color, rgba(255, 255, 255, .3)) solid 100vw;touch-action:none}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]{outline-width:100vh}}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:after{position:absolute;content:"";inset:0;pointer-events:none;border:dashed 1px;opacity:.75;color:inherit;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{width:100%;cursor:move;border:var(--cropper-border, 1px solid rgba(255, 255, 255, .5))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:hover   .ngx-ic-move[_ngcontent-%COMP%]{border:var(--cropper-hover-border, var(--cropper-border, 1px solid rgba(255, 255, 255, .5)))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:focus   .ngx-ic-move[_ngcontent-%COMP%]{border:var(--cropper-focus-border, 2px solid dodgerblue)}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]:focus   .ngx-ic-resize[_ngcontent-%COMP%]   .ngx-ic-square[_ngcontent-%COMP%]{background:var(--cropper-resize-square-focus-bg, var(--cropper-resize-square-bg, #53535C));border:var(--cropper-resize-square-focus-border, var(--cropper-resize-square-border, 1px solid rgba(255, 255, 255, .5)))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]{position:absolute;display:inline-block;line-height:6px;padding:8px;opacity:.85;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]   .ngx-ic-square[_ngcontent-%COMP%]{display:inline-block;width:6px;height:6px;box-sizing:content-box;background:var(--cropper-resize-square-bg, #53535C);border:var(--cropper-resize-square-border, 1px solid rgba(255, 255, 255, .5))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%]:hover   .ngx-ic-square[_ngcontent-%COMP%]{background:var(--cropper-resize-square-hover-bg, var(--cropper-resize-square-bg, #53535C));border:var(--cropper-resize-square-hover-border, var(--cropper-resize-square-border, 1px solid rgba(255, 255, 255, .5)))}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topleft[_ngcontent-%COMP%]{top:-12px;left:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-top[_ngcontent-%COMP%]{top:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-topright[_ngcontent-%COMP%]{top:-12px;right:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-right[_ngcontent-%COMP%]{top:calc(50% - 12px);right:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomright[_ngcontent-%COMP%]{bottom:-12px;right:-12px;cursor:nwse-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-12px;left:calc(50% - 12px);cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-bottomleft[_ngcontent-%COMP%]{bottom:-12px;left:-12px;cursor:nesw-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize.ngx-ic-left[_ngcontent-%COMP%]{top:calc(50% - 12px);left:-12px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%]{position:absolute;z-index:1}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-top[_ngcontent-%COMP%]{top:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-right[_ngcontent-%COMP%]{top:11px;right:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-bottom[_ngcontent-%COMP%]{bottom:-11px;left:11px;width:calc(100% - 22px);height:22px;cursor:ns-resize}[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar.ngx-ic-left[_ngcontent-%COMP%]{top:11px;left:-11px;height:calc(100% - 22px);width:22px;cursor:ew-resize}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]{outline-color:transparent}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{border-radius:100%;box-shadow:0 0 0 100vw var(--cropper-outline-color, rgba(255, 255, 255, .3))}@media (orientation: portrait){[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]:after{box-shadow:0 0 0 100vh var(--cropper-outline-color, rgba(255, 255, 255, .3))}}[_nghost-%COMP%]   .ngx-ic-cropper.ngx-ic-round[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{border-radius:100%}.disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-resize-bar[_ngcontent-%COMP%], .disabled[_nghost-%COMP%]   .ngx-ic-cropper[_ngcontent-%COMP%]   .ngx-ic-move[_ngcontent-%COMP%]{display:none}.ngx-ic-hidden[_nghost-%COMP%]{display:none}'],changeDetection:0})}}return r})();var nt=(()=>{class r{constructor(){this.close=()=>{},this.uploadImage=()=>{},this.maintainAspectRatio=!0,this.aspectRatio=1,this.dataUrl="",this.width=0,this.height=0,this.croppedDataUrl="",this.uiSize=320,this.updateUiSize()}updateUiSize(){let e=window.innerWidth||0,i=window.innerHeight||0,n=Math.min(e,i),o=Math.max(240,n-240);this.uiSize=o}imageCropped(e){this.croppedDataUrl=e.base64||""}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=q({type:r,selectors:[["app-file-cropper"]],hostBindings:function(i,n){i&1&&_("resize",function(){return n.updateUiSize()},le)},decls:6,vars:5,consts:[[1,"file-cropper"],[1,"file-cropper__cropper"],["output","base64","format","png",3,"imageCropped","maintainAspectRatio","aspectRatio","imageBase64","resizeToWidth","resizeToHeight"],[1,"file-cropper__actions"],[3,"click"]],template:function(i,n){i&1&&(l(0,"div",0)(1,"div",1)(2,"image-cropper",2),_("imageCropped",function(a){return n.imageCropped(a)}),m()(),l(3,"div",3)(4,"wbutton",4),_("click",function(){return n.uploadImage(n.croppedDataUrl),n.close()}),v(5,"Crop"),m()()()),i&2&&(g(2),w("maintainAspectRatio",n.maintainAspectRatio)("aspectRatio",n.aspectRatio)("imageBase64",n.dataUrl)("resizeToWidth",n.width)("resizeToHeight",n.height))},dependencies:[it,Ge],styles:["[_nghost-%COMP%]{display:block;box-sizing:border-box;padding:var(--sp-4);max-block-size:90vh}.file-cropper[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:var(--sp-3);inline-size:min(96vw,960px);block-size:100%;margin-inline:auto}.file-cropper__cropper[_ngcontent-%COMP%]{flex:1 1 auto;min-block-size:0;border-radius:var(--b-radius-card);overflow:hidden;background:var(--c-bg-secondary)}.file-cropper__cropper[_ngcontent-%COMP%]   image-cropper[_ngcontent-%COMP%]{display:block;inline-size:100%;block-size:100%}.file-cropper__actions[_ngcontent-%COMP%]{flex:0 0 auto;display:flex;justify-content:flex-end;margin-top:var(--sp-2)}"],changeDetection:0})}}return r})();var zt=r=>({$implicit:r,index:0}),Rt=(r,t)=>({$implicit:r,index:t});function Tt(r,t){if(r&1&&(l(0,"div",4),v(1),Y(2,"translate"),m()),r&2){c();let e=F(0);g(),W($(2,1,e)())}}function St(r,t){if(r&1&&(l(0,"div",11),v(1),Y(2,"translate"),m()),r&2){c(3);let e=F(1);g(),W($(2,1,e)())}}function Ot(r,t){if(r&1&&(Z(0,10),V(1,St,3,3,"ng-template",null,1,te)),r&2){let e=A(2),i=c(2);w("ngTemplateOutlet",i.t_empty()||e)}}function Ft(r,t){if(r&1&&I(0,"img",13),r&2){let e=c().$implicit;w("src",e,G)}}function Pt(r,t){if(r&1&&(l(0,"span",14),v(1),m()),r&2){let e=c().$implicit;g(),W(e)}}function Vt(r,t){if(r&1&&k(0,Ft,1,1,"img",13)(1,Pt,2,1,"span",14),r&2){let e=t.$implicit,i=c(3);H(i.preview()&&i.isImage(e)?0:1)}}function kt(r,t){if(r&1&&(Z(0,12),V(1,Vt,2,1,"ng-template",null,2,te)),r&2){let e=A(2),i=c(2),n=F(2);w("ngTemplateOutlet",i.t_item()||e)("ngTemplateOutletContext",qe(2,zt,n[0]))}}function Ht(r,t){if(r&1){let e=T();l(0,"button",15),_("click",function(n){return p(e),c(2).clear(),h(n.stopPropagation())}),v(1," close "),m()}}function At(r,t){if(r&1){let e=T();l(0,"div",8),_("click",function(){p(e);let n=c(),o=A(7);return h(n.triggerPick(o))}),k(1,Ot,3,1)(2,kt,3,4),k(3,Ht,2,0,"button",9),m()}if(r&2){let e=c(),i=F(2);g(),H(i.length===0?1:2),g(2),H(e.clearable()&&i.length?3:-1)}}function Wt(r,t){if(r&1&&(l(0,"div",11),v(1),Y(2,"translate"),m()),r&2){c(3);let e=F(1);g(),W($(2,1,e)())}}function Dt(r,t){if(r&1&&(Z(0,10),V(1,Wt,3,3,"ng-template",null,1,te)),r&2){let e=A(2),i=c(2);w("ngTemplateOutlet",i.t_empty()||e)}}function Ut(r,t){if(r&1&&I(0,"img",13),r&2){let e=c().$implicit;w("src",e,G)}}function Et(r,t){if(r&1){let e=T();l(0,"span",14),v(1),m(),k(2,Ut,1,1,"img",13),l(3,"button",15),_("click",function(){let n=p(e).index,o=c(4);return h(o.removeAt(n))}),v(4," close "),m()}if(r&2){let e=t.$implicit,i=c(4);g(),W(e),g(),H(i.preview()&&i.isImage(e)?2:-1)}}function Lt(r,t){if(r&1&&(l(0,"li",21),Z(1,12),V(2,Et,5,2,"ng-template",null,2,te),m()),r&2){let e=t.$implicit,i=t.$index,n=A(3),o=c(3);g(),w("ngTemplateOutlet",o.t_item()||n)("ngTemplateOutletContext",Ne(2,Rt,e,i))}}function Bt(r,t){if(r&1&&(l(0,"ul"),De(1,Lt,4,5,"li",21,We),m()),r&2){c(2);let e=F(2);g(),Ue(e)}}function jt(r,t){if(r&1){let e=T();l(0,"button",22),_("click",function(){p(e);let n=c(2);return h(n.clear())}),l(1,"span",19),v(2,"close"),m(),l(3,"span"),v(4),Y(5,"translate"),m()()}if(r&2){c(2);let e=F(3);w("disabled",e),g(4),W($(5,2,"Clear")())}}function qt(r,t){if(r&1){let e=T();l(0,"div",7)(1,"div",16),k(2,Dt,3,1)(3,Bt,3,0,"ul"),m(),l(4,"div",17)(5,"button",18),_("click",function(){p(e);let n=c(),o=A(7);return h(n.triggerPick(o))}),l(6,"span",19),v(7,"upload_file"),m(),l(8,"span"),v(9),Y(10,"translate"),m()(),k(11,jt,6,4,"button",20),m()()}if(r&2){let e=c(),i=F(2),n=F(3);g(2),H(i.length===0?2:3),g(3),w("disabled",n),g(4),W($(10,4,"Browse")()),g(2),H(e.clearable()&&i.length?11:-1)}}var Ii=(()=>{class r{constructor(){this.label=y(z.label),this.placeholder=y(z.placeholder),this.disabled=y(z.disabled),this.clearable=y(z.clearable),this.accept=y(z.accept),this.preview=y(z.preview),this.mode=y(z.mode),this.view=y(z.view),this.cropWidth=y(z.cropWidth),this.cropHeight=y(z.cropHeight),this.t_item=y(),this.t_empty=y(),this.container=y(z.container),this.name=y(z.name),this.wImage=ne(null,{alias:"wImage"}),this.wFile=ne(null,{alias:"wFile"}),this.wImages=ne([],{alias:"wImages"}),this.wFiles=ne([],{alias:"wFiles"}),this._modal=Q(Je),this._fs=Q(Me),this.isDisabled=ie(()=>this.disabled()),this.isMultiple=ie(()=>this.mode().startsWith("multi-")),this.isImageMode=ie(()=>this.mode().includes("image")),this.files=ie(()=>{switch(this.mode()){case"single-image":return this.wImage()?[this.wImage()]:[];case"single-file":return this.wFile()?[this.wFile()]:[];case"multi-image":return this.wImages();case"multi-file":return this.wFiles();default:return[]}})}triggerPick(e){this.isDisabled()||e.click()}isImage(e){return/\.(png|jpe?g|webp|gif)(\?|$)/i.test(e??"")}onPicked(e){return M(this,null,function*(){let i=e.files;if(!i||!i.length)return;let n=this.isImageMode()&&!!this.cropWidth()&&!!this.cropHeight(),o=[],a=this.container(),s=this.name();for(let d=0;d<i.length;d++){let u=i.item(d),S=yield Ze(u);if(n)yield new Promise(b=>{this._modal.show({component:nt,size:"big",dataUrl:S,width:this.cropWidth(),height:this.cropHeight(),uploadImage:f=>{this._fs.uploadBase64(f,a,s).then(x=>{o.push(x),b()})}})});else{let b=yield this._fs.uploadBase64(S,a,s);o.push(b)}if(!this.isMultiple())break}this._applyNewUrls(o),e.value=""})}removeAt(e){let i=this.mode();if(i==="single-image"){this.wImage.set(null);return}if(i==="single-file"){this.wFile.set(null);return}let n=[...this.files()];n.splice(e,1),i==="multi-image"?this.wImages.set(n):i==="multi-file"&&this.wFiles.set(n)}clear(){let e=this.mode();e==="single-image"?this.wImage.set(null):e==="single-file"?this.wFile.set(null):e==="multi-image"?this.wImages.set([]):e==="multi-file"&&this.wFiles.set([])}_applyNewUrls(e){let i=this.mode();if(e.length){if(i==="single-image"){this.wImage.set(e[0]??null);return}if(i==="single-file"){this.wFile.set(e[0]??null);return}if(i==="multi-image"){this.wImages.set([...this.wImages(),...e]);return}i==="multi-file"&&this.wFiles.set([...this.wFiles(),...e])}}static{this.\u0275fac=function(i){return new(i||r)}}static{this.\u0275cmp=q({type:r,selectors:[["ngx-file"]],inputs:{label:[1,"label"],placeholder:[1,"placeholder"],disabled:[1,"disabled"],clearable:[1,"clearable"],accept:[1,"accept"],preview:[1,"preview"],mode:[1,"mode"],view:[1,"view"],cropWidth:[1,"cropWidth"],cropHeight:[1,"cropHeight"],t_item:[1,"t_item"],t_empty:[1,"t_empty"],container:[1,"container"],name:[1,"name"],wImage:[1,"wImage"],wFile:[1,"wFile"],wImages:[1,"wImages"],wFiles:[1,"wFiles"]},outputs:{wImage:"wImageChange",wFile:"wFileChange",wImages:"wImagesChange",wFiles:"wFilesChange"},decls:10,vars:10,consts:[["fileInput",""],["emptyTpl",""],["itemTpl",""],[1,"wfile"],[1,"wfile__label"],["type","file","hidden","",3,"change"],[1,"wfile__body","wfile__body--thumb-only"],[1,"wfile__body"],[1,"wfile__body","wfile__body--thumb-only",3,"click"],["type","button",1,"wfile__remove","material-icons"],[3,"ngTemplateOutlet"],[1,"wfile__empty"],[3,"ngTemplateOutlet","ngTemplateOutletContext"],["alt","preview",1,"wfile__thumb",3,"src"],[1,"wfile__name"],["type","button",1,"wfile__remove","material-icons",3,"click"],[1,"wfile__list"],[1,"wfile__actions"],["type","button",1,"wfile__btn",3,"click","disabled"],[1,"material-icons"],["type","button",1,"wfile__btn","wfile__btn--ghost",3,"disabled"],[1,"wfile__item"],["type","button",1,"wfile__btn","wfile__btn--ghost",3,"click","disabled"]],template:function(i,n){if(i&1){let o=T();je(0)(1)(2)(3),l(4,"div",3),k(5,Tt,3,3,"div",4),l(6,"input",5,0),_("change",function(){p(o);let s=A(7);return h(n.onPicked(s))}),m(),k(8,At,4,2,"div",6)(9,qt,12,6,"div",7),m()}if(i&2){let o=ee(n.label());g(),ee(n.placeholder()),g(),ee(n.files()),g();let a=ee(n.isDisabled()),s=n.view();g(),X("_disabled",a),g(),H(o?5:-1),g(),J("accept",n.accept())("multiple",n.isMultiple()?"":null),g(2),H(s==="thumb-only"?8:9)}},dependencies:[Ye,Ce],styles:["[_nghost-%COMP%]{display:block}.wfile._disabled[_ngcontent-%COMP%]{opacity:.6;pointer-events:none}.wfile__label[_ngcontent-%COMP%]{margin-bottom:6px}.wfile__body[_ngcontent-%COMP%]{border:2px solid var(--c-text-primary);border-radius:12px;padding:12px;background:var(--c-bg-secondary);color:var(--c-text-primary)}.wfile__list[_ngcontent-%COMP%]{margin-bottom:10px}.wfile__list[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{margin:0;padding:0;list-style:none}.wfile__empty[_ngcontent-%COMP%]{color:var(--c-text-primary);opacity:.8}.wfile__item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;padding:6px 0;border-bottom:1px solid var(--c-border)}.wfile__item[_ngcontent-%COMP%]:last-child{border-bottom:0}.wfile__name[_ngcontent-%COMP%]{max-width:50%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.wfile__thumb[_ngcontent-%COMP%]{width:64px;height:64px;object-fit:cover;border-radius:8px;border:1px solid var(--c-border)}.wfile__remove[_ngcontent-%COMP%]{border:0;background:transparent;cursor:pointer;color:var(--c-text-primary);display:inline-flex;align-items:center;justify-content:center;border-radius:8px;padding:4px}.wfile__actions[_ngcontent-%COMP%]{display:flex;gap:8px}.wfile__btn[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:6px;padding:8px 12px;border-radius:10px;border:2px solid var(--c-primary);background:var(--c-primary);color:var(--c-white);cursor:pointer}.wfile__btn--ghost[_ngcontent-%COMP%]{background:transparent;color:var(--c-primary)}"],changeDetection:0})}}return r})();export{z as a,Ii as b};
